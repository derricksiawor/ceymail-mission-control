// CeyMail Mission Control â€” allow ceymail-mc to manage whitelisted mail services
// Install: cp deploy/polkit/45-ceymail-mc.rules /usr/share/polkit-1/rules.d/

polkit.addRule(function(action, subject) {
    var validUnits = [
        "ceymail-dashboard.service",
        "postfix.service",
        "dovecot.service",
        "mariadb.service",
        "opendkim.service",
        "spamassassin.service",
        "spamd.service",
        "apache2.service",
        "nginx.service",
        "unbound.service",
        "rsyslog.service",
        "php8.1-fpm.service",
        "php8.2-fpm.service",
        "php8.3-fpm.service",
        "php8.4-fpm.service"
    ];

    var validVerbs = ["start", "stop", "restart", "reload", "enable", "disable"];

    if (action.id === "org.freedesktop.systemd1.manage-units" &&
        subject.user === "ceymail-mc" &&
        validUnits.indexOf(action.lookup("unit")) >= 0 &&
        validVerbs.indexOf(action.lookup("verb")) >= 0) {
        return polkit.Result.YES;
    }
});
